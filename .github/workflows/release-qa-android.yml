name: QA Android Release (EAS)

on:
  release:
    types: [published]

jobs:
  build-android-qa:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    env:
      EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
      GOOGLE_SERVICE_ACCOUNT_KEY: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_KEY }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node + PNPM + Install
        uses: ./.github/actions/setup-node-pnpm-install

      - name: Write Google Play service account key
        shell: bash
        env:
          GOOGLE_SERVICE_ACCOUNT_KEY: ${{ secrets.GOOGLE_SERVICE_ACCOUNT_KEY }}
        run: |
          mkdir -p .github/keys
          echo "$GOOGLE_SERVICE_ACCOUNT_KEY" > .github/keys/play.json

      - name: EAS build & auto-submit (Android Beta track)
        uses: ./.github/actions/eas-build
        with:
          platform: android
          profile: beta
          auto-submit: 'true'
          submit-profile: beta
